<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OS Travel & Tours Chatbot</title>
  <style>
    /* Floating Button */
    .chatbot-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #0078ff;
      color: white;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,.2);
      z-index: 1000;
    }

    /* Chatbox */
    .chatbot-container {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 360px;
      height: 520px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 8px 28px rgba(0,0,0,.22);
      display: none;
      flex-direction: column;
      overflow: hidden;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      z-index: 1000;
    }

    .chatbot-header {
      background: linear-gradient(135deg, #0078ff, #0056cc);
      color: white;
      padding: 12px;
      font-weight: 700;
      text-align: center;
      font-size: 16px;
    }

    .chatbot-messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      font-size: 14px;
      background: #f9fbff;
    }

    .chatbot-input {
      display: flex;
      border-top: 1px solid #e6ecf5;
      background: #fff;
    }

    .chatbot-input input {
      flex: 1;
      padding: 12px;
      border: none;
      outline: none;
      font-size: 14px;
    }

    .chatbot-input button {
      padding: 10px 14px;
      border: none;
      background: #0078ff;
      color: white;
      cursor: pointer;
      font-weight: 600;
    }

    .bot-message, .user-message {
      margin: 6px 0;
      padding: 9px 12px;
      border-radius: 10px;
      max-width: 85%;
      clear: both;
      line-height: 1.35;
      white-space: pre-wrap;
    }

    .bot-message {
      background: #eef5ff;
      color: #0b2a5a;
      float: left;
    }

    .user-message {
      background: #0078ff;
      color: white;
      float: right;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 8px 0 2px;
    }

    .chip {
      background: #ffffff;
      border: 1px solid #d9e6ff;
      color: #0b2a5a;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      transition: all .15s ease;
    }
    .chip:hover { background: #eef5ff; }

    .muted { opacity: .85; font-size: 12px; }
    .small { font-size: 12px; }

    .divider {
      height: 1px;
      background: #e6ecf5;
      margin: 10px 0;
    }
  </style>
</head>
<body>

  <!-- Floating Button -->
  <div class="chatbot-button" onclick="toggleChat()" title="Chat with OS Travel & Tours">üí¨</div>

  <!-- Chatbox -->
  <div class="chatbot-container" id="chatbot">
    <div class="chatbot-header">OS Travel & Tours ‚Äî Visa & Tickets</div>
    <div class="chatbot-messages" id="messages">
      <div class="bot-message">
        üëã Hi! I‚Äôm your OS Travel Assistant. Ask me about visas (fees, documents, processing), tickets, hotel bookings, insurance, or visa file processing (Schengen/UK/USA/Australia/Canada).
        <div class="chips" id="quickChips"></div>
        <div class="muted">Tip: try ‚ÄúSingapore visa price‚Äù, ‚ÄúAzerbaijan documents‚Äù, ‚ÄúDo you do Schengen?‚Äù</div>
      </div>
    </div>
    <div class="chatbot-input">
      <input type="text" id="userInput" placeholder="Type a message‚Ä¶"/>
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    /**********************
     * CONFIG
     **********************/
    const API_KEY = "AIzaSyCduUjLNhVTo8QVBO6Dz5kpi7oFk99shX4"; // ‚Üê replace with your Gemini API key

    // Contact info (from your site)
    const contactInfo = `üìç Office # 3, Aaly Plaza, Fazal-e-Haq Rd, Block E G 6/2, Blue Area, Islamabad
üìû (051) 2120700‚Äì701, 0333-5542877
‚úâÔ∏è info@ostravels.com, ostravelsisb@gmail.com`;

    /**********************
     * DATA harvested from ost ravels .com (visa pages)
     * Sources (for your reference):
     * - Azerbaijan: https://ostravels.com/visa/azerbaijan-visa/
     * - Uzbekistan: https://ostravels.com/visa/uzbekistan-visa/
     * - Singapore:  https://ostravels.com/visa/singapore-visa/
     * - Kyrgyzstan: https://ostravels.com/visa/kyrgyzstan-visa/
     * - Kazakhstan: https://ostravels.com/visa/kazakhstan/
     * - Visa list:  https://ostravels.com/visa/
     * - Contact:    https://ostravels.com/contact-2/
     **********************/

    // Countries OS Travel deals in (Visa menu)
    const countriesServed = [
      "Malaysia","Singapore","Hong Kong","Indonesia","Thailand","Egypt","Cambodia","Azerbaijan",
      "Tajikistan","Uzbekistan","China","Turkey","Kyrgyzstan","Sri Lanka","Vietnam","Nepal",
      "Philippines","Saudi Arabia","Kazakhstan"
    ];

    // Visa file processing (embassy) countries
    const visaFileCountries = [
      "France","Spain","United Kingdom","United States","Australia","Canada","Belgium","Netherlands",
      "Poland","Germany","Italy","Hungary","Greece","Czech Republic","Switzerland","Portugal","Denmark",
      "Sweden","Norway"
    ];

    // Per-country structured facts (fees in site currency; ‚Äúprices subject to change‚Äù line will be added)
    const visas = {
      "Azerbaijan": {
        fee: "PKR 8,000 (sticker) ‚Ä¢ eVisa USD 50",
        validity: "1 month (sticker) ‚Ä¢ eVisa 35 days",
        category: "Single entry",
        stay: "Up to 30 days",
        processing: "Sticker 10‚Äì15 working days ‚Ä¢ eVisa 3‚Äì5 working days",
        evisa: "Available for Pakistani citizens (single entry)",
        docs: [
          "Passport (6+ months validity)",
          "4 photos (35√ó50mm, white background)",
          "CNIC copy",
          "Last 6 months bank statement",
          "Bank maintenance letter",
          "Visa request letter",
          "Invitation/Telex from Azerbaijan",
          "NTN (if applicable)",
          "Return ticket"
        ],
        source: "Azerbaijan"
      },
      "Uzbekistan": {
        fee: "USD 85 (embassy fee only; telex & service charges extra)",
        validity: "1 month",
        category: "Single entry",
        stay: "As per request",
        processing: "12‚Äì15 working days",
        evisa: "Not available yet for Pakistani passport (apply via embassy)",
        docs: [
          "Passport (6+ months validity)",
          "4 photos (35√ó50mm, white background)",
          "Last 6 months bank statement",
          "Bank maintenance letter",
          "NTN",
          "Visa request letter",
          "CNIC copy",
          "Return ticket",
          "Visa form (filled)",
          "Telex from Uzbekistan (we can arrange)"
        ],
        source: "Uzbekistan"
      },
      "Singapore": {
        fee: "PKR 18,000",
        validity: "1 month (35 days for eVisa)",
        category: "Single entry",
        stay: "Up to 1 month",
        processing: "7‚Äì10 working days (consulate) ‚Ä¢ 10‚Äì15 working days (eVisa; case dependent)",
        evisa: "Yes ‚Äî apply via ICA-authorized agent (OS Travel has ID)",
        docs: [
          "Passport (6+ months validity)",
          "4 photos (35√ó50mm, white background) or 1 photo for eVisa",
          "CNIC copy",
          "Last 6 months bank statement",
          "Bank maintenance letter",
          "Visa request letter",
          "Invitation letter (citizen/company) for consulate route",
          "NTN / tax returns (if applicable)",
          "Employer letter & last 3 salary slips (if employed)",
          "Return ticket"
        ],
        source: "Singapore"
      },
      "Kyrgyzstan": {
        fee: "USD 250 (eVisa)",
        validity: "Varies",
        category: "Single entry (commonly)",
        stay: "Varies",
        processing: "Varies (apply online or embassy)",
        evisa: "Available ‚Äî invitation letter typically required",
        docs: [
          "Completed visa form",
          "Passport (6+ months validity)",
          "Photo (passport size; white background)",
          "Flight & hotel bookings",
          "Proof of funds",
          "Invitation letter (if applicable)",
          "Visa fee receipt"
        ],
        source: "Kyrgyzstan"
      },
      "Kazakhstan": {
        fee: "USD 60 (consulate)",
        validity: "30 days",
        category: "Single entry",
        stay: "30 days",
        processing: "3‚Äì5 working days",
        evisa: "Not available for Pakistani citizens",
        docs: [
          "Passport (6+ months validity)",
          "4 photos (35√ó50mm, white background)",
          "Online visa application",
          "6-month bank statement",
          "Visa request letter",
          "Hotel booking",
          "Return air ticket",
          "Travel insurance",
          "Visa support number (MIA Kazakhstan)"
        ],
        source: "Kazakhstan"
      }
    };

    // Services offered
    const services = [
      "Visa Services (eVisa + Embassy/File Processing)",
      "Air Ticketing",
      "Hotel Booking",
      "Travel Insurance",
      "Visa File Preparation (Schengen, UK, USA, Australia, Canada, etc.)"
    ];

    /**********************
     * UI helpers
     **********************/
    function toggleChat() {
      const chat = document.getElementById("chatbot");
      chat.style.display = chat.style.display === "flex" ? "none" : "flex";
      if (chat.style.display === "flex") renderChips();
    }

    function addMessage(text, sender) {
      const messages = document.getElementById("messages");
      const div = document.createElement("div");
      div.className = sender === "bot" ? "bot-message" : "user-message";
      div.innerText = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
      return div; // return node (for replacing "..." with AI response)
    }

    function renderChips() {
      const chipNames = ["Which countries do you handle?", "Singapore visa price", "Azerbaijan documents", "Uzbekistan processing time", "Kyrgyzstan e-visa", "Schengen file process"];
      const quick = document.getElementById("quickChips");
      quick.innerHTML = "";
      chipNames.forEach(label => {
        const btn = document.createElement("button");
        btn.className = "chip";
        btn.textContent = label;
        btn.onclick = () => {
          document.getElementById("userInput").value = label;
          sendMessage();
        };
        quick.appendChild(btn);
      });
    }

    /**********************
     * NLP-ish helpers
     **********************/
    const norm = s => s.normalize("NFKC").toLowerCase().trim();

    function bestCountryMatch(text) {
      const t = norm(text);
      const all = [...Object.keys(visas), ...countriesServed, ...visaFileCountries];
      let best = null, score = 0;
      all.forEach(c => {
        const n = c.toLowerCase();
        if (t.includes(n)) { // simple contains
          if (n.length > score) { score = n.length; best = c; }
        }
      });
      return best;
    }

    function isContactIntent(t) {
      return /\b(address|location|located|phone|phone number|contact|office|email|whatsapp)\b/i.test(t);
    }

    function isIdentityIntent(t) {
      return /\b(who (do )?you work for|who are you|who (am|r) i talking to|who is this)\b/i.test(t);
    }

    function isCountryListIntent(t) {
      return /\b(which countries|what countries|countries you (deal|handle)|do you do (visas|visa) for|visa list)\b/i.test(t);
    }

    function isPriceIntent(t) {
      return /\b(price|fee|cost|charges?)\b/i.test(t);
    }

    function isDocsIntent(t) {
      return /\b(documents?|docs?|requirements?|needed|need to apply|paperwork)\b/i.test(t);
    }

    function isTimeIntent(t) {
      return /\b(process(ing)? time|how long|days|duration|timeline)\b/i.test(t);
    }

    function isEvisaIntent(t) {
      return /\bev-?visa|online visa|apply online\b/i.test(t);
    }

    function isServicesIntent(t) {
      return /\b(services|what do you offer|tickets?|insurance|hotels?)\b/i.test(t);
    }

    /**********************
     * Response formatters
     **********************/
    function formatCountryCard(country) {
      const v = visas[country];
      if (!v) {
        // countries we handle but no detailed card yet
        return `üåç We handle ${country} visas. For fees & latest requirements, please call us:\n${contactInfo}`;
      }

      const parts = [
        `üõÇ ${country} Visa`,
        v.fee ? `‚Ä¢ Fee: ${v.fee}` : "",
        v.validity ? `‚Ä¢ Visa validity: ${v.validity}` : "",
        v.category ? `‚Ä¢ Category: ${v.category}` : "",
        v.stay ? `‚Ä¢ Allowed stay: ${v.stay}` : "",
        v.processing ? `‚Ä¢ Processing time: ${v.processing}` : "",
        v.evisa ? `‚Ä¢ e-Visa: ${v.evisa}` : "",
        v.docs && v.docs.length ? `\nüìÑ Documents:\n- ${v.docs.join("\n- ")}` : ""
      ].filter(Boolean).join("\n");

      return parts + `\n\n‚ìò Prices/timelines can change; confirm with our team.\n${contactInfo}`;
    }

    function listCountries() {
      return `üåê Countries we handle (visas):\n` +
        `‚Ä¢ ${countriesServed.join(", ")}\n\n` +
        `üìÅ Visa file processing (embassy support):\n` +
        `‚Ä¢ ${visaFileCountries.join(", ")}\n\n` +
        `Need a country not listed? Ask me!`;
    }

    function listServices() {
      return `üß≠ Our services:\n- ${services.join("\n- ")}\n\n${contactInfo}`;
    }

    /**********************
     * Chat flow
     **********************/
    async function sendMessage() {
      const input = document.getElementById("userInput");
      const original = input.value.trim();
      const msg = norm(original);
      if (!msg) return;

      addMessage(original, "user");
      input.value = "";

      // High-priority routing
      if (isContactIntent(original)) {
        addMessage(contactInfo, "bot");
        return;
      }

      if (isIdentityIntent(original)) {
        addMessage("ü§ñ I‚Äôm the official OS Travel & Tours assistant.", "bot");
        return;
      }

      if (isCountryListIntent(original)) {
        addMessage(listCountries(), "bot");
        return;
      }

      if (isServicesIntent(original)) {
        addMessage(listServices(), "bot");
        return;
      }

      // Country-specific intents
      const country = bestCountryMatch(original);
      if (country) {
        // If the user asked generally (‚Äúdocuments/price/time/eVisa‚Äù), tailor the snippet
        if (isDocsIntent(original) || isPriceIntent(original) || isTimeIntent(original) || isEvisaIntent(original)) {
          addMessage(formatCountryCard(country), "bot");
          return;
        }
        // Otherwise give the full card
        addMessage(formatCountryCard(country), "bot");
        return;
      }

      // Generic FAQs
      if (/\b(ticket|flight|air ?ticket(ing)?)\b/i.test(original)) {
        addMessage("‚úàÔ∏è We book domestic & international flights at competitive rates. Share your route & dates, or call us:\n" + contactInfo, "bot");
        return;
      }
      if (/\b(hotel|booking)\b/i.test(original)) {
        addMessage("üè® Yes ‚Äî we arrange hotel bookings tailored to your trip & budget.", "bot");
        return;
      }
      if (/\b(insurance)\b/i.test(original)) {
        addMessage("üõ°Ô∏è We provide travel insurance options for Schengen and global trips.", "bot");
        return;
      }
      if (/\b(umrah|saudi)\b/i.test(original)) {
        addMessage("üïã We offer Umrah support and Saudi visit visa assistance. Message your preferred dates.", "bot");
        return;
      }
      if (/\b(schengen|uk|usa|australia|canada)\b/i.test(original)) {
        addMessage("üìÅ We prepare visa files for Schengen, UK, USA, Australia, Canada ‚Äî docs, appointments & guidance. Ask for a country to see requirements.", "bot");
        return;
      }

      // Otherwise call Gemini fallback (kept within travel scope)
      const placeholder = addMessage("...", "bot");

      try {
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text:
`ROLE: You are the official assistant for OS Travel & Tours (Islamabad).
SCOPE: Only answer about visas, tickets, travel packages, hotel booking, travel insurance, and visa file processing.
BRAND DATA (authoritative):
- Contact: ${contactInfo}
- Services: ${services.join(", ")}
- Countries: ${countriesServed.join(", ")}
- Visa File Countries: ${visaFileCountries.join(", ")}
- Country facts (fees/processing/docs): ${JSON.stringify(visas)}

POLICY:
- If asked for a country we handle, answer with fee, validity, category, stay, processing, e-visa note, and bullet documents.
- If asked for countries, show both lists.
- If user asks unrelated things, politely redirect to call.
- Always add: "Prices/timelines can change; please confirm with our team."

User: ${original}`
                }]}
              ]
            })
          }
        );

        const data = await res.json();
        const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text
          || `üôè Sorry, I couldn‚Äôt get that. Please call us:\n${contactInfo}`;

        placeholder.innerText = reply;

      } catch (err) {
        console.error(err);
        placeholder.innerText = `‚ö†Ô∏è Our system is busy. Please try again or call us:\n${contactInfo}`;
      }
    }
  </script>
</body>
</html>
